# 2. HTTP Сервер

## Обработчики (handlers)

В Go есть два основных способа создать обработчик:

### 1. Функция (http.HandlerFunc)
```go
func homeHandler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Добро пожаловать на главную!")
}

func main() {
    http.HandleFunc("/", homeHandler)
    http.ListenAndServe(":8080", nil)
}
```

### 2. Тип, реализующий интерфейс http.Handler
```go
type ApiHandler struct {
    message string
}

func (h *ApiHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "API сообщение: %s", h.message)
}

func main() {
    handler := &ApiHandler{message: "Привет от API"}
    http.Handle("/api", handler)
    http.ListenAndServe(":8080", nil)
}
```

## Мультиплексер и роутинг

Мультиплексер (`ServeMux`) направляет запросы к нужным обработчикам:

```go
package main

import (
    "fmt"
    "net/http"
)

func main() {
    // Создаем собственный мультиплексер
    mux := http.NewServeMux()
    
    // Регистрируем обработчики
    mux.HandleFunc("/", homeHandler)
    mux.HandleFunc("/about", aboutHandler)
    mux.HandleFunc("/users/", usersHandler) // "/" в конце = любой подпуть
    
    fmt.Println("Сервер на :8080")
    http.ListenAndServe(":8080", mux)
}

func homeHandler(w http.ResponseWriter, r *http.Request) {
    if r.URL.Path != "/" {
        http.NotFound(w, r)
        return
    }
    fmt.Fprintf(w, "Главная страница")
}

func aboutHandler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "О нас")
}

func usersHandler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Пользователи. Путь: %s", r.URL.Path)
}
```

## Методы HTTP запросов

Проверяем HTTP метод в обработчике:

```go
func apiHandler(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodGet:
        fmt.Fprintf(w, "GET запрос - получаем данные")
    case http.MethodPost:
        fmt.Fprintf(w, "POST запрос - создаем данные")
    case http.MethodPut:
        fmt.Fprintf(w, "PUT запрос - обновляем данные")
    case http.MethodDelete:
        fmt.Fprintf(w, "DELETE запрос - удаляем данные")
    default:
        w.WriteHeader(http.StatusMethodNotAllowed)
        fmt.Fprintf(w, "Метод %s не поддерживается", r.Method)
    }
}

func main() {
    http.HandleFunc("/api", apiHandler)
    http.ListenAndServe(":8080", nil)
}
```

## Работа с параметрами запроса

### Query параметры (URL параметры)
```go
func searchHandler(w http.ResponseWriter, r *http.Request) {
    // Получаем query параметры
    query := r.URL.Query()
    
    // Один параметр
    q := query.Get("q")           // /search?q=golang
    
    // Множественные параметры
    tags := query["tag"]          // /search?tag=web&tag=api
    
    // С проверкой существования
    if limit := query.Get("limit"); limit != "" {
        fmt.Fprintf(w, "Поиск: %s, лимит: %s, теги: %v", q, limit, tags)
    } else {
        fmt.Fprintf(w, "Поиск: %s, теги: %v", q, tags)
    }
}
```

### Path параметры (простой способ)
```go
func userHandler(w http.ResponseWriter, r *http.Request) {
    // Извлекаем ID из пути /users/123
    path := r.URL.Path
    if path == "/users/" {
        fmt.Fprintf(w, "Список всех пользователей")
        return
    }
    
    // Простое извлечение ID
    userID := path[len("/users/"):]
    fmt.Fprintf(w, "Пользователь ID: %s", userID)
}
```

### Полный пример сервера
```go
package main

import (
    "fmt"
    "net/http"
)

func main() {
    mux := http.NewServeMux()
    
    mux.HandleFunc("/", homeHandler)
    mux.HandleFunc("/search", searchHandler)
    mux.HandleFunc("/users/", userHandler)
    
    fmt.Println("Сервер запущен: http://localhost:8080")
    fmt.Println("Попробуйте:")
    fmt.Println("  http://localhost:8080/")
    fmt.Println("  http://localhost:8080/search?q=golang&limit=10")
    fmt.Println("  http://localhost:8080/users/123")
    
    http.ListenAndServe(":8080", mux)
}

func homeHandler(w http.ResponseWriter, r *http.Request) {
    if r.URL.Path != "/" {
        http.NotFound(w, r)
        return
    }
    fmt.Fprintf(w, "Добро пожаловать! Метод: %s", r.Method)
}

func searchHandler(w http.ResponseWriter, r *http.Request) {
    q := r.URL.Query().Get("q")
    limit := r.URL.Query().Get("limit")
    fmt.Fprintf(w, "Поиск: '%s', лимит: '%s'", q, limit)
}

func userHandler(w http.ResponseWriter, r *http.Request) {
    userID := r.URL.Path[len("/users/"):]
    fmt.Fprintf(w, "Информация о пользователе: %s", userID)
}
```

---